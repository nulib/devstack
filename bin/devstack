#!/usr/bin/env ruby

begin
  this_file = __FILE__
  this_file = File.readlink(this_file) while File.symlink?(this_file)
  $LOAD_PATH << File.expand_path('../../lib', this_file)
end
require 'dev_stack/cli'

case ARGV.first
when 'version', '-v', '--version'
  DevStack.display_version
when 'link'
  DevStack.link!
when 'update'
  DevStack.update!
else
  environment = ENV['DEVSTACK_ENV']
  if ARGV[0] == '-t'
    environment = 'test'
    ARGV.slice!(0)
  end
  stack = ENV['DEVSTACK_STACK']
  stack = ARGV.slice!(-1) if ARGV.length > 1 && ARGV.last.to_s !~ /^-/
  options = { 'environment' => environment, 'stack' => stack }.reject { |k,v| v.nil? }
  DevStack::CLI.new(options).exec!
end
