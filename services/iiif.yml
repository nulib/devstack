service_definition:
  image: nulib/iiif-express
  read_only: true
  volumes:
    - type: volume
      target: /tmp
    - type: volume
      target: /var/run
  ports:
    - <%= offset_port(8182) %>:3000
  environment:
    - TIFF_BUCKET=dev-pyramids
    - S3_ENDPOINT=http://minio:9000/
    - AWS_ACCESS_KEY_ID=minio
    - AWS_SECRET_ACCESS_KEY=minio123
  healthcheck:
    test:
      - CMD
      - wget
      - "--quiet"
      - "--tries=1"
      - "--spider"
      - http://localhost:3000/iiif/2/
    interval: 30s
    timeout: 5s
    retries: 3
